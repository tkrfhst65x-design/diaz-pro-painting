<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Díaz Pro Painting LLC</title>

<style>
/* ===================== BASE ===================== */
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
  background:#070b14;
  color:#fff;
}
.wrap{max-width:1100px;margin:auto;padding:20px}
.card{
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:16px;
  padding:16px;
}
h2{margin:0 0 10px}

/* ===================== REVIEWS ===================== */
.review-wrap{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
}
@media(max-width:900px){
  .review-wrap{grid-template-columns:1fr}
}

.stars{display:flex;gap:6px}
.star{
  cursor:pointer;
  padding:6px 10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.2);
  opacity:.4;
}
.star.active{opacity:1;color:#ffd166}

.field{margin-top:10px}
input,textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,.2);
  background:#0003;
  color:#fff;
}
textarea{min-height:80px}

.btn{
  margin-top:10px;
  padding:10px 14px;
  border-radius:12px;
  border:0;
  cursor:pointer;
  background:#2b6cff;
  color:#fff;
  font-weight:700;
}
.btn.secondary{background:#ffffff22}

.avg{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}

/* ===== REVIEWS CAROUSEL ===== */
.reviews-carousel{position:relative}
.reviews-viewport{overflow:hidden}
.reviews-track{
  display:flex;
  gap:12px;
  transition:transform .35s ease;
}

.review-item{
  flex:0 0 calc((100% - 24px) / 3);
  background:#ffffff08;
  border:1px solid #ffffff22;
  border-radius:14px;
  padding:12px;
}
@media(max-width:900px){
  .review-item{flex:0 0 100%}
}

.review-top{
  display:flex;
  justify-content:space-between;
  font-weight:700;
}
.review-stars{color:#ffd166}
.review-text{opacity:.85;margin-top:6px}

.car-btn{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:34px;
  height:34px;
  border-radius:50%;
  border:0;
  background:#0008;
  color:#fff;
  cursor:pointer;
}
.car-btn.prev{left:-10px}
.car-btn.next{right:-10px}
.car-btn:disabled{opacity:.3;cursor:not-allowed}
</style>
</head>

<body>
<div class="wrap">
  <h2>Customer Reviews</h2>

  <div class="review-wrap">

    <!-- LEFT: FORM -->
    <div class="card">
      <strong>Leave a review</strong>

      <div class="field">
        <input id="reviewName" placeholder="Your name">
      </div>

      <div class="field">
        <div class="stars" id="stars"></div>
      </div>

      <div class="field">
        <textarea id="reviewText" placeholder="Write your comment"></textarea>
      </div>

      <button class="btn" id="submitReview">Submit review</button>
      <button class="btn secondary" id="clearReviews">Clear</button>
    </div>

    <!-- RIGHT: LIST -->
    <div class="card">
      <div class="avg">
        <div>Average</div>
        <strong id="avgValue">—</strong>
      </div>

      <div class="reviews-carousel">
        <button class="car-btn prev" id="revPrev">‹</button>

        <div class="reviews-viewport" id="reviewsViewport">
          <div class="reviews-track" id="reviewList"></div>
        </div>

        <button class="car-btn next" id="revNext">›</button>
      </div>
    </div>

  </div>
</div>

<script>
/* ===================== SUPABASE ===================== */
const SUPABASE_URL = "https://vdmziwjjlejpjqjmtift.supabase.co";
const SUPABASE_KEY = "sb_publishable_GwgON26mgy-47QJAu6qh0w_AsF3CEfo";
const ENDPOINT = `${SUPABASE_URL}/rest/v1/reviews`;

/* ===================== STARS ===================== */
const starWrap = document.getElementById("stars");
let selectedStars = 0;
function renderStars(){
  starWrap.innerHTML="";
  for(let i=1;i<=5;i++){
    const s=document.createElement("div");
    s.className="star"+(i<=selectedStars?" active":"");
    s.textContent="★";
    s.onclick=()=>{selectedStars=i;renderStars()};
    starWrap.appendChild(s);
  }
}
renderStars();

/* ===================== FETCH ===================== */
async function fetchReviews(){
  const r=await fetch(`${ENDPOINT}?select=name,rating,comment&approved=eq.true&order=created_at.desc`,{
    headers:{apikey:SUPABASE_KEY,Authorization:`Bearer ${SUPABASE_KEY}`}
  });
  return r.ok ? r.json() : [];
}

/* ===================== CAROUSEL ===================== */
let revIndex=0;
function updateCarousel(total){
  const pageSize=window.innerWidth<900?1:3;
  const pages=Math.ceil(total/pageSize);
  revIndex=Math.max(0,Math.min(revIndex,pages-1));
  const w=document.getElementById("reviewsViewport").clientWidth;
  document.getElementById("reviewList").style.transform=`translateX(-${revIndex*w}px)`;
  revPrev.disabled=revIndex===0;
  revNext.disabled=revIndex===pages-1;
}

/* ===================== RENDER ===================== */
async function renderReviews(){
  const list=document.getElementById("reviewList");
  const avgEl=document.getElementById("avgValue");
  list.innerHTML="";
  const arr=await fetchReviews();
  if(!arr.length){avgEl.textContent="—";return}
  avgEl.textContent=(arr.reduce((a,b)=>a+b.rating,0)/arr.length).toFixed(1);
  arr.forEach(r=>{
    const d=document.createElement("div");
    d.className="review-item";
    d.innerHTML=`
      <div class="review-top">
        <span>${r.name||"Anonymous"}</span>
        <span class="review-stars">${"★".repeat(r.rating)}</span>
      </div>
      <div class="review-text">${r.comment}</div>`;
    list.appendChild(d);
  });
  revIndex=0;
  updateCarousel(arr.length);
}

/* ===================== SUBMIT ===================== */
submitReview.onclick=async()=>{
  if(!selectedStars||!reviewText.value.trim()) return alert("Fill stars and comment");
  await fetch(ENDPOINT,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      apikey:SUPABASE_KEY,
      Authorization:`Bearer ${SUPABASE_KEY}`
    },
    body:JSON.stringify([{name:reviewName.value||"Anonymous",rating:selectedStars,comment:reviewText.value}])
  });
  reviewName.value="";
  reviewText.value="";
  selectedStars=0;
  renderStars();
  renderReviews();
};

clearReviews.onclick=()=>{
  reviewName.value="";
  reviewText.value="";
  selectedStars=0;
  renderStars();
};

/* ===================== NAV ===================== */
revPrev.onclick=()=>{revIndex--;renderReviews()};
revNext.onclick=()=>{revIndex++;renderReviews()};
window.onresize=()=>renderReviews();

renderReviews();
</script>
</body>
</html>



